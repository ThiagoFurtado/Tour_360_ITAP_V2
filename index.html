<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

    <title>Tour 360° - ITAP</title> <!-- MELHORIA: Título um pouco mais descritivo -->

    <!--
        O script de verificação de login foi comentado.
        Se for reativado, considere movê-lo para o final do <body> para não bloquear
        o carregamento da página, a menos que o bloqueio imediato seja um requisito de segurança.
    -->

    <!-- Links de Estilo (CSS) -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="libs/photo-sphere-viewer.css">
    <link rel="stylesheet" href="libs/photo-sphere-viewer-markers.css">
    <!-- Carregando Swiper de um CDN. Está correto. -->
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />

    <!-- Import Map para módulos JavaScript. Os caminhos relativos com "./" estão corretos. -->
    <script type="importmap">
    {
        "imports": {
            "three": "./libs/three.module.js",
            "@photo-sphere-viewer/core": "./libs/photo-sphere-viewer.module.js",
            "@photo-sphere-viewer/markers-plugin": "./libs/photo-sphere-viewer-markers.module.js"
        }
    }
    </script>
</head>

<body>
    <div id="app">
        <aside class="sidebar">
            <section class="floors">
                <h2>Escolha do pavimento</h2>
                <ul id="floor-list" role="list"></ul>
            </section>

            <section class="plan">
                <h2>Planta baixa</h2>
                
                <floor-plan id="plan" role="application" aria-label="Planta baixa interativa">
                    <!-- A estrutura interna do componente está correta e permite que o JS o controle. -->
                    <div class="container loading">
                        <div class="panzoom-wrapper">
                            <img class="map-image" alt="Planta baixa do pavimento selecionado" src="" /> <!-- MELHORIA: Adicionado src="" para conformidade com HTML. O JS irá alterá-lo. -->
                            <div class="markers-overlay"></div>
                        </div>
                    </div>
                </floor-plan>
                <p class="plan-instructions">
                    Use <strong>gestos de pinça</strong> para zoom e <strong>arraste</strong> para mover. (Compatível com mouse e toque )
                </p>
            </section>
        </aside>

        <section class="viewer">
            <div id="viewer" aria-live="polite"></div>

            <div id="welcome-overlay">
                <div class="welcome-content">
                    <h2>Bem-vindo ao Tour Interativo</h2>
                    <p>Explore o ambiente de forma fácil e intuitiva:</p>
                    <ul>
                        <li><strong>Selecione um pavimento</strong> na lista à esquerda para carregar a planta correspondente.</li>
                        <li>Na planta, <strong>toque nos marcadores</strong> para visualizar o local em 360°.</li>
                        <li>Na visualização 360°, <strong>toque e arraste</strong> para olhar ao redor.</li>
                    </ul>
                </div>
            </div>

            <div class="viewer-loader" aria-hidden="true"></div>
        </section>
    </div>

    <!-- Scripts carregados no final do body para melhor performance -->
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    
    <!-- Módulos JS. Os caminhos relativos estão corretos para o GitHub Pages. -->
    <script type="module" src="components/floor-plan.js"></script>
    <script type="module" src="main.js"></script>

    <!-- SUGESTÃO: Mover o script de login para cá -->
    <script>
        // Se o script de login for reativado, esta é uma localização melhor.
        // Ele executa após o DOM ser carregado, mas ainda bloqueia a renderização final.
        // if (sessionStorage.getItem('loggedIn' ) !== 'true') {
        //     window.location.href = 'login.html';
        // }
    </script>
</body>
</html>
